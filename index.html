<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>庭林群青 11+12C 專業複驗系統</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        body { background-color: #f4f6f9; padding-bottom: 100px; font-family: "Microsoft JhengHei", sans-serif; }
        
        /* 頂部固定區 */
        .sticky-header { 
            position: sticky; top: 0; z-index: 1000; 
            background: #2c3e50; color: white; 
            padding: 15px 0 10px 0; 
            box-shadow: 0 4px 6px rgba(0,0,0,0.1); 
        }
        .progress { background-color: rgba(255,255,255,0.2); height: 20px; border-radius: 10px; }
        
        /* 卡片設計 */
        .card { 
            border: none; 
            border-radius: 12px; 
            margin-bottom: 20px; 
            box-shadow: 0 2px 8px rgba(0,0,0,0.05); 
            transition: transform 0.2s;
            overflow: hidden;
        }
        .card-header {
            background-color: #fff;
            border-bottom: 1px solid #eee;
            padding: 12px 15px;
            font-weight: 700;
            color: #2c3e50;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .card-body { padding: 15px; }
        
        /* 狀態樣式 */
        .fixed-card { border: 2px solid #28a745; background-color: #f0fff4; }
        .fixed-card .card-header { background-color: #e6fffa; color: #28a745; }
        
        .failed-card { border: 2px solid #dc3545; background-color: #fff5f5; }
        .failed-card .card-header { background-color: #fff0f0; color: #dc3545; }

        /* 標籤 */
        .photo-badge { 
            font-size: 0.75em; 
            background-color: #6c757d; 
            color: white; 
            padding: 4px 8px; 
            border-radius: 20px; 
            letter-spacing: 0.5px;
        }
        .area-badge {
            font-size: 0.8em;
            background-color: #e9ecef;
            color: #495057;
            padding: 2px 6px;
            border-radius: 4px;
            margin-right: 5px;
        }

        /* 按鈕群組 */
        .btn-check:checked + .btn-outline-success {
            background-color: #28a745; color: white;
        }
        .btn-check:checked + .btn-outline-danger {
            background-color: #dc3545; color: white;
        }
        .btn-action-group { display: flex; gap: 10px; margin-top: 15px; }
        .btn-action-group label { flex: 1; padding: 10px 0; font-weight: bold; }
        
        /* 單項重置按鈕 */
        .btn-reset-item {
            font-size: 0.85em;
            color: #999;
            text-decoration: none;
            display: inline-block;
            margin-top: 10px;
            transition: color 0.3s;
            border: 1px solid #eee;
            padding: 4px 10px;
            border-radius: 20px;
            background: white;
        }
        .btn-reset-item:hover { color: #333; border-color: #ccc; background: #f8f9fa; }

        /* 分頁按鈕 */
        .nav-pills .nav-link { 
            color: #666; 
            background: white; 
            margin: 0 5px; 
            border: 1px solid #ddd;
        }
        .nav-pills .nav-link.active { 
            background-color: #0d6efd; 
            color: white; 
            border-color: #0d6efd;
            box-shadow: 0 4px 6px rgba(13, 110, 253, 0.3);
        }
    </style>
</head>
<body>

<div class="sticky-header">
    <div class="container">
        <div class="d-flex justify-content-between align-items-center mb-2">
            <h5 class="m-0 fw-bold"><i class="fas fa-clipboard-check me-2"></i>庭林群青 複驗</h5>
            <span class="badge bg-warning text-dark" id="statusText">進度: 0%</span>
        </div>
        <div class="progress">
            <div id="progressBar" class="progress-bar progress-bar-striped progress-bar-animated bg-success" role="progressbar" style="width: 0%"></div>
        </div>
        <div class="d-flex justify-content-between mt-1 px-1 small" style="opacity: 0.8;">
            <span>已修復: <b id="fixedCount">0</b></span>
            <span>總缺失: <b id="totalCount">0</b></span>
        </div>
    </div>
</div>

<div class="container mt-4">
    <ul class="nav nav-pills mb-4 justify-content-center" id="pills-tab" role="tablist">
        <li class="nav-item" role="presentation">
            <button class="nav-link active" id="pills-11f-tab" data-bs-toggle="pill" data-bs-target="#pills-11f" type="button" role="tab">11 樓</button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="pills-12f-tab" data-bs-toggle="pill" data-bs-target="#pills-12f" type="button" role="tab">12 樓</button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="pills-stair-tab" data-bs-toggle="pill" data-bs-target="#pills-stair" type="button" role="tab">樓梯間</button>
        </li>
    </ul>

    <div class="tab-content" id="pills-tabContent">
        <div class="tab-pane fade show active" id="pills-11f" role="tabpanel"><div id="list-11f"></div></div>
        <div class="tab-pane fade" id="pills-12f" role="tabpanel"><div id="list-12f"></div></div>
        <div class="tab-pane fade" id="pills-stair" role="tabpanel"><div id="list-stair"></div></div>
    </div>
</div>

<nav class="navbar fixed-bottom navbar-light bg-white border-top shadow-lg">
    <div class="container-fluid justify-content-center gap-3">
        <button class="btn btn-secondary px-4" onclick="window.print()">
            <i class="fas fa-print me-1"></i> 列印 PDF
        </button>
        <button class="btn btn-outline-danger px-4" onclick="resetAll()">
            <i class="fas fa-trash-restore me-1"></i> 全部重置
        </button>
    </div>
</nav>

<script>
    // 缺失資料庫 (來源：驗屋報告PDF Source 18-49)
    const defects = {
        "11f": [
            { area: "客廳 (L)", item: "門框(扇)", desc: "髒污、刮損", page: "13" },
            { area: "客廳 (L)", item: "牆體", desc: "客變 (需確認圖面)", page: "-" },
            { area: "客廳 (L)", item: "地板", desc: "木地板不平整(凹陷)", page: "14" },
            { area: "客廳 (L)", item: "弱電系統", desc: "網路插座未施作", page: "13" },
            { area: "客廳 (L)", item: "插座", desc: "中性對接地帶電位(漏電)、方向安裝相反", page: "13、14" },
            { area: "客廳 (L)", item: "窗戶", desc: "髒污、刮損、凹損", page: "13" },
            { area: "客廳 (L)", item: "電箱", desc: "迴路中性對接地帶電位、標示錯誤", page: "14" },
            { area: "客廳 (L)", item: "客變內容", desc: "與圖面不符", page: "14、15" },
            { area: "廚房 (K)", item: "牆體/天花板", desc: "客變 (需確認圖面)", page: "-" },
            { area: "廚房 (K)", item: "地板", desc: "木地板不平整(凹陷)", page: "16" },
            { area: "廚房 (K)", item: "系統櫃", desc: "破損、髒污", page: "15" },
            { area: "廚房 (K)", item: "爐台/抽油煙機", desc: "爐台刮痕、抽油煙管與插座迴風(管線收邊不實)", page: "16" },
            { area: "廚房 (K)", item: "插座", desc: "安裝不實", page: "16" },
            { area: "廚房 (K)", item: "客變內容", desc: "與圖面不符", page: "17" },
            { area: "浴室 (T1)", item: "門框(扇)", desc: "髒污、刮損、門檻石材破損", page: "17" },
            { area: "浴室 (T1)", item: "牆體", desc: "髒污、石材裂紋", page: "17、18" },
            { area: "浴室 (T1)", item: "地板", desc: "填縫不實", page: "17" },
            { area: "浴室 (T1)", item: "衛浴設備", desc: "洗手台矽利康收邊未施作", page: "18" },
            { area: "臥室 (R1)", item: "門框(扇)", desc: "髒污、刮損", page: "18" },
            { area: "臥室 (R1)", item: "牆體/天花板", desc: "客變 (需確認圖面)", page: "-" },
            { area: "臥室 (R1)", item: "窗戶", desc: "髒污、刮損、矽利康施作不實", page: "18、19" },
            { area: "臥室 (R1)", item: "插座", desc: "中性對接地帶電位", page: "19" },
            { area: "陽台 (B1)", item: "門框(扇)", desc: "髒污、刮損、凹損", page: "19" },
            { area: "陽台 (B1)", item: "牆面", desc: "填縫不實、石材破損、導角刮損", page: "20、21" },
            { area: "陽台 (B1)", item: "插座/電燈", desc: "燈罩髒污", page: "21" },
            { area: "陽台 (B1)", item: "天花板", desc: "填縫不實", page: "21" },
            { area: "陽台 (B1)", item: "洩水坡度", desc: "洩水坡度不足(積水)", page: "21" },
            { area: "陽台 (B1)", item: "窗戶", desc: "外側刮損/凹損", page: "20" }
        ],
        "12f": [
            { area: "起居室 (L)", item: "門框(扇)", desc: "髒污、刮損", page: "26" },
            { area: "起居室 (L)", item: "牆體/地板", desc: "客變 (需確認圖面)", page: "-" },
            { area: "起居室 (L)", item: "窗戶", desc: "髒污、刮損", page: "26" },
            { area: "起居室 (L)", item: "電箱", desc: "鎖點壓到線皮、保護蓋未安裝", page: "26" },
            { area: "起居室 (L)", item: "客變內容", desc: "與圖面不符", page: "27" },
            { area: "浴室 (T1)", item: "門框(扇)", desc: "髒污、刮損、門檻石材破損", page: "27" },
            { area: "浴室 (T1)", item: "牆體", desc: "破損、填縫不實", page: "28" },
            { area: "浴室 (T1)", item: "地板", desc: "填縫不實", page: "28" },
            { area: "浴室 (T1)", item: "衛浴設備", desc: "洗手台石材裂紋、壓鈕安裝不實(無法洩水)", page: "29" },
            { area: "浴室 (T1)", item: "窗戶", desc: "髒污、刮損", page: "28" },
            { area: "浴室 (T2)", item: "門框(扇)", desc: "髒污、刮損", page: "29" },
            { area: "浴室 (T2)", item: "牆體", desc: "破損、填縫不實、石材裂紋", page: "30" },
            { area: "浴室 (T2)", item: "天花板", desc: "髒污", page: "30" },
            { area: "浴室 (T2)", item: "地板", desc: "填縫不實", page: "31" },
            { area: "浴室 (T2)", item: "地排", desc: "淤積", page: "31" },
            { area: "浴室 (T2)", item: "衛浴設備", desc: "洗手台石材裂紋/刮痕、鏡面髒污、浴缸矽利康未施作/石材裂紋", page: "31" },
            { area: "浴室 (T2)", item: "窗戶", desc: "髒污、刮損、矽利康施作不實", page: "29" },
            { area: "臥室 (R1)", item: "門框(扇)", desc: "髒污、刮損", page: "32" },
            { area: "臥室 (R1)", item: "牆體/天花板", desc: "客變 (需確認圖面)", page: "-" },
            { area: "臥室 (R1)", item: "窗戶", desc: "髒污、刮損", page: "32、33" },
            { area: "臥室 (R1)", item: "客變內容", desc: "與圖面不符", page: "33" },
            { area: "陽台 (B1)", item: "門框(扇)", desc: "髒污、刮損、凹損", page: "34" },
            { area: "陽台 (B1)", item: "地磚", desc: "空心", page: "36" },
            { area: "陽台 (B1)", item: "牆面", desc: "二丁掛磚空心、填縫不實、缺磚、石材破損", page: "34、35" },
            { area: "陽台 (B1)", item: "插座/電燈", desc: "插座收邊不實", page: "35" },
            { area: "陽台 (B1)", item: "洩水坡度", desc: "洩水坡度不足(積水)", page: "36" },
            { area: "陽台 (B1)", item: "護欄", desc: "刮損", page: "35" }
        ],
        "stair": [
            { area: "樓梯間", item: "地板", desc: "樓梯不平整", page: "38" },
            { area: "樓梯間", item: "扶手", desc: "未安裝", page: "-" }
        ]
    };

    let totalItems = 0;
    let fixedItems = 0;

    function init() {
        totalItems = defects['11f'].length + defects['12f'].length + defects['stair'].length;
        document.getElementById('totalCount').innerText = totalItems;
        
        renderList('11f', defects['11f']);
        renderList('12f', defects['12f']);
        renderList('stair', defects['stair']);
        
        loadStatus();
        updateProgress();
    }

    function renderList(floorId, data) {
        const container = document.getElementById(`list-${floorId}`);
        container.innerHTML = "";
        
        data.forEach((item, index) => {
            const uniqueId = `${floorId}-${index}`;
            const html = `
                <div class="card" id="card-${uniqueId}">
                    <div class="card-header">
                        <span><span class="area-badge">${item.area}</span> ${item.item}</span>
                        <span class="photo-badge"><i class="fas fa-camera"></i> P.${item.page}</span>
                    </div>
                    <div class="card-body">
                        <p class="card-text text-dark fw-bold mb-3" style="font-size: 1.1em;">${item.desc}</p>
                        
                        <div class="btn-action-group">
                            <input type="radio" class="btn-check" name="status-${uniqueId}" id="btn-fix-${uniqueId}" autocomplete="off" onclick="setStatus('${uniqueId}', 'fixed')">
                            <label class="btn btn-outline-success shadow-sm" for="btn-fix-${uniqueId}"><i class="fas fa-check-circle"></i> 已修復</label>

                            <input type="radio" class="btn-check" name="status-${uniqueId}" id="btn-fail-${uniqueId}" autocomplete="off" onclick="setStatus('${uniqueId}', 'failed')">
                            <label class="btn btn-outline-danger shadow-sm" for="btn-fail-${uniqueId}"><i class="fas fa-times-circle"></i> 仍有缺失</label>
                        </div>

                        <div class="d-flex justify-content-between align-items-center mt-3">
                            <input type="text" class="form-control form-control-sm me-2" id="note-${uniqueId}" placeholder="備註 (如: 仍有小刮痕...)" onchange="saveNote('${uniqueId}')">
                            <button class="btn-reset-item" onclick="clearStatus('${uniqueId}')" title="清除此項狀態">
                                <i class="fas fa-undo-alt"></i> 清除狀態
                            </button>
                        </div>
                    </div>
                </div>
            `;
            container.innerHTML += html;
        });
    }

    // 設定狀態 (修復/缺失)
    function setStatus(id, status) {
        const card = document.getElementById(`card-${id}`);
        card.classList.remove('fixed-card', 'failed-card');
        
        if (status === 'fixed') {
            card.classList.add('fixed-card');
            localStorage.setItem(id, 'fixed');
        } else {
            card.classList.add('failed-card');
            localStorage.setItem(id, 'failed');
        }
        updateProgress();
    }

    // 清除單一項目的狀態 (取消重置)
    function clearStatus(id) {
        // 1. 清除 LocalStorage
        localStorage.removeItem(id);

        // 2. 取消 Radio 按鈕選取
        const btnFix = document.getElementById(`btn-fix-${id}`);
        const btnFail = document.getElementById(`btn-fail-${id}`);
        if(btnFix) btnFix.checked = false;
        if(btnFail) btnFail.checked = false;

        // 3. 移除卡片樣式
        const card = document.getElementById(`card-${id}`);
        card.classList.remove('fixed-card', 'failed-card');

        // 4. 更新進度
        updateProgress();
    }

    function saveNote(id) {
        const val = document.getElementById(`note-${id}`).value;
        localStorage.setItem(`note-${id}`, val);
    }

    function updateProgress() {
        fixedItems = 0;
        const allKeys = Object.keys(localStorage);
        allKeys.forEach(key => {
            if (localStorage.getItem(key) === 'fixed') {
                fixedItems++;
            }
        });

        const percentage = Math.round((fixedItems / totalItems) * 100);
        const progressBar = document.getElementById('progressBar');
        progressBar.style.width = percentage + "%";
        
        document.getElementById('statusText').innerText = `進度: ${percentage}%`;
        document.getElementById('fixedCount').innerText = fixedItems;
    }

    function loadStatus() {
        const allKeys = Object.keys(localStorage);
        allKeys.forEach(key => {
            if (key.startsWith('note-')) {
                const uniqueId = key.replace('note-', '');
                const input = document.getElementById(`note-${uniqueId}`);
                if (input) input.value = localStorage.getItem(key);
            } else {
                const status = localStorage.getItem(key);
                if (status === 'fixed') {
                    const btn = document.getElementById(`btn-fix-${key}`);
                    if (btn) {
                        btn.checked = true;
                        document.getElementById(`card-${key}`).classList.add('fixed-card');
                    }
                } else if (status === 'failed') {
                    const btn = document.getElementById(`btn-fail-${key}`);
                    if (btn) {
                        btn.checked = true;
                        document.getElementById(`card-${key}`).classList.add('failed-card');
                    }
                }
            }
        });
    }

    function resetAll() {
        if(confirm("警告：這將會清除所有已勾選的紀錄，確定要重置嗎？")) {
            localStorage.clear();
            location.reload();
        }
    }

    init();
</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
